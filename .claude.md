# Claude Instructions for BetterAI Engine

## General
- Prefer direct, concise responses where possible.
- Suggest alternatives and raise concerns if you see issues or problems with the current design that do not align with industry best practices.
- Less code is better: Choose solutions that involve less custom code or reduce code where possible Simpler for AI Agent: choose solutions that are simpler for the AI agent, less likely for it to make mistakes.
- Clear documentation Write code that's easy to understand and modify later. Add single-line comments to explain major code sections


## Database Migrations

**NEVER manually apply database migrations.**

- Do NOT create scripts to apply SQL migrations directly
- Do NOT use `sql.unsafe()` or similar methods to run migration files
- Always use drizzle-kit commands: `db:generate`, `db:migrate`, or `db:push`
- If drizzle-kit fails, inform the user and let them handle it manually
- The user will manage migration issues themselves

## Logging Guidelines

**Use `logger` (from `utils/logger.ts`) for:**
- All application/business logic logging
- Internal operations (fetching, ingestion, experiments)
- Error tracking and debugging
- Performance monitoring
- Structured data with context: `logger.info({ marketId, experimentId }, 'message')`

**Use `console.log/error` ONLY for:**
- User-facing CLI output (results, help text, formatted tables)
- Critical startup errors before logger is initialized
- Configuration debug output (when behind a DEBUG flag)

**Best Practices:**
- ✅ `logger.info({ marketId: '123' }, 'Fetching market')`
- ✅ `console.log('\n=== RESULTS ===')` (user output)
- ❌ `console.log('Fetching market 123')` (should use logger)
- ❌ `logger.info('Results:', results)` (should use console for user output)

**Log Levels:**
- `logger.debug()` - Verbose debugging (hidden in production)
- `logger.info()` - Normal operations
- `logger.warn()` - Warnings that don't stop execution
- `logger.error()` - Errors and exceptions

## Project Guidelines

- Follow the design document at [docs/design_betteraiengine.md](docs/design_betteraiengine.md)
- Use the existing service architecture (polymarket, ingestion, prediction)
- Maintain structured logging with pino
- Keep raw JSONB data alongside structured tables
- All environment variables are stored in `.env.local` (not `.env`)
- Use the centralized `env` config from `src/config/env.ts` instead of `process.env`
